"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-three/fiber");require("@babel/runtime/helpers/extends");var r=require("@babel/runtime/helpers/objectWithoutPropertiesLoose");require("three-stdlib");var i=require("three"),n=require("./ContactShadows.cjs.js");require("use-asset"),require("../helpers/environment-assets.cjs.js");var a=require("./Environment.cjs.js");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=o(r),u={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};exports.Stage=function(r){var o=r.children,c=r.controls,l=r.shadows,d=void 0===l||l,h=r.adjustCamera,m=void 0===h||h,f=r.environment,p=void 0===f?"city":f,v=r.contactShadow,g=void 0===v||v,b=r.intensity,w=void 0===b?1:b,y=r.preset,j=void 0===y?"rembrandt":y,x=s.default(r,["children","controls","shadows","adjustCamera","environment","contactShadow","intensity","preset"]),E=u[j],q=t.useThree((function(e){return e.camera})),S=e.useRef(null),L=e.useRef(null),C=e.useState({radius:0,width:0,height:0}),M=C[0],P=M.radius,B=M.width,O=M.height,R=C[1];return e.useLayoutEffect((function(){S.current.position.set(0,0,0),S.current.updateWorldMatrix(!0,!0);var e=(new i.Box3).setFromObject(L.current),t=new i.Vector3,r=new i.Sphere,n=e.max.y-e.min.y,a=e.max.x-e.min.x;e.getCenter(t),e.getBoundingSphere(r),R({radius:r.radius,width:a,height:n}),S.current.position.set(-t.x,-t.y+n/2,-t.z)}),[o]),e.useLayoutEffect((function(){if(m){var e=P/(O>B?1.5:2.5);q.position.set(0,.5*P,2.5*P),q.near=.1,q.far=Math.max(5e3,4*P),q.lookAt(0,e,0),c&&c.current&&(c.current.target.set(0,e,0),c.current.update())}}),[P,O,B,m]),e.createElement("group",x,e.createElement("group",{ref:S},e.createElement("group",{ref:L},o)),g&&e.createElement(n.ContactShadows,{"rotation-x":Math.PI/2,opacity:.5,width:2*P,height:2*P,blur:2,far:P/2}),p&&e.createElement(a.Environment,{preset:p}),e.createElement("ambientLight",{intensity:w/3}),e.createElement("spotLight",{position:[E.main[0]*P,E.main[1]*P,E.main[2]*P],intensity:2*w,castShadow:d}),e.createElement("pointLight",{position:[E.fill[0]*P,E.fill[1]*P,E.fill[2]*P],intensity:w}))};
